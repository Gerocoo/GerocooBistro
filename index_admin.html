<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerocoo bistrot - Admin</title>
  <link rel="stylesheet" href="cookies.css">
  <link rel="stylesheet" href="//cdn.datatables.net/2.3.1/css/dataTables.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    integrity="sha512-papmSR5i6Rx3e4+QeOZTnHlLMJQ7u5LOj+YqM0aNcfm3BQ3BSlUn8N+BB69U92t2bFi3p6gS2kOx7uqgUN2MMA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
</head>
<script>
$(document).ready(function () {
    $.get('/dati-prenotazioni', function (dati) {
        const oggi = new Date();
        oggi.setHours(0, 0, 0, 0);

        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }

        const dateUniche = [...new Set(dati
            .map(row => row.data)
            .filter(d => {
                const dataObj = new Date(d);
                return dataObj >= oggi && dataObj <= addDays(oggi, 7);
            })
        )].sort((a, b) => new Date(a) - new Date(b));

        dateUniche.forEach(data => {
            const dataObj = new Date(data);
            const label = dataObj.toDateString() === oggi.toDateString() ? "Oggi" : dataObj.toLocaleDateString('it-IT');
            $('#filtriDate').append(
                $('<button>')
                    .text(label)
                    .attr('data-data', data)
            );
        });

        $('#filtriDate').on('click', 'button', function () {
            const dataSelezionata = $(this).attr('data-data');
            tabella.column(1).search(dataSelezionata).draw();
        });
    });
});
</script>

<body>
  <nav id="navbar-example2" class="topnav">
    <button class="toggle-theme" id="toggle-theme">ðŸŒ™</button>
    <button class="btn btn-outline-secondary btn-hamburger" type="button" data-bs-toggle="offcanvas"
      data-bs-target="#offcanvasMenu" aria-controls="offcanvasMenu">â˜°</button>
    <ul class="nav nav-pills nav-desktop">
      <li class="nav-item">
        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#menuModal">Menu</a>
      </li>
      <li class="nav-item"><a class="nav-link" href="#Storia">Storia</a></li>
      <li class="nav-item"><a class="nav-link" href="#Chisiamo">Contatti</a></li>
      <li class="nav-item"><a class="nav-link" href="#Prenota">Prenota il tuo tavolo</a></li>
    </ul>
  </nav>

  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasMenu" aria-labelledby="offcanvasMenuLabel">
    <div class="offcanvas-header">
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Chiudi"></button>
    </div>
    <div class="offcanvas-body">
      <!-- Menu mobile se necessario -->
    </div>
  </div>

  <div class="modal fade" id="menuModal" tabindex="-1" aria-labelledby="menuModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- Contenuto del modal se necessario -->
      </div>
    </div>
  </div>

  <div style="display: flex; justify-content: center; margin-top: 50px;">
    <img src="img/logo1.png" alt="Bistro Catering Logo" class="logo" />
  </div>

  <h1 class="titolo"><a href="storia.html">GEROCOO BISTROT - ADMIN</a></h1>
  <p style="text-align: center; margin-top: 20px;">Pannello di amministrazione - Gestione prenotazioni</p>

  <div class="container mt-5">
    <h2>Prenotazioni</h2>
    <div id="filtriDate" style="margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;"></div>
    <div class="table-responsive">
      <table id="tabellaPrenotazioni" class="display table table-striped" style="width:100%">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Data</th>
            <th>Orario</th>
            <th>Numero Persone</th>
            <th>Contatti</th>
            <th>Celiachia</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody>
          <!-- I dati verranno caricati via AJAX -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- jQuery DEVE essere caricato PRIMA di DataTables -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="//cdn.datatables.net/2.3.1/js/dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
  <script>
    $(document).ready(function() {
      
      
      $('#tabellaPrenotazioni').DataTable({
        ajax: {
          url: '/dati-prenotazioni',
          dataSrc: '', // perchÃ© la risposta Ã¨ un array diretto
          error: function(xhr, error, code) {
            console.error('Errore AJAX:', error);
            console.error('Codice:', code);
            console.error('Response:', xhr.responseText);
          }
        },
        columns: [
          { data: 'nome' },
          { 
            data: 'data',
            render: function(data, type, row) {
              // Formatta la data in italiano
              return moment(data).locale('it').format('DD/MM/YYYY');
            }
          },
          { data: 'orario' },
          { data: 'numero' },
          { data: 'contatti' },
          { data: 'celiachia' },
          { data: 'note' }
        ],
        language: {
          url: '//cdn.datatables.net/plug-ins/2.0.0/i18n/it-IT.json'
        },
        order: [[1, 'desc']], // Ordina per data decrescente
       
        responsive: true
      });
    });
    
  </script>
  <script src="https://cdn.datatables.net/2.3.1/js/dataTables.js"></script>
  <script src="cookies.js"></script>
  <script>
    var options = {
      settings: {
        cookie_title: 'Gerocoo Bistrot cookies'
      },
      cookies: [
        {
          id: "1",
          name: "Consenso Raccolta Cookie",
          used_for: "Necessario per salvare le preferenze sui cookie dell'utente.",
          url_text: "Privacy Policy",
          url: "https://example.com/privacy",
          accepted_function: "console.log('cookieConsent accepted');",
          declined_function: "console.log('cookieConsent declined');"
        },
        {
          id: "2",
          name: "Google Analytics",
          used_for: "Raccogliere dati anonimi su come i visitatori utilizzano il sito web.",
          url_text: "Privacy Policy di Google",
          url: "https://policies.google.com/privacy",
          accepted_function: "console.log('Google Analytics accepted');",
          declined_function: "console.log('Google Analytics declined');"
        }
      ]
    };

    if (typeof cookiemunch === 'function') {
      cookiemunch(options);
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment/locale/it.js"></script>
</body>
</html>